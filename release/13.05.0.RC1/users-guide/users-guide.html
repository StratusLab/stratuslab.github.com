<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="StratusLab Collaboration">
  <title>StratusLab User's Guide</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="css/screen.css">
</head>
<body>
<header>
<h1 class="title">StratusLab User's Guide</h1>
<h2 class="author">StratusLab Collaboration</h2>
<h3 class="date">Version 13.05.0.RC1</h3>
</header>
<nav id="TOC">
<ul>
<li><a href="#preface"><span class="toc-section-number">1</span> Preface</a><ul>
<li><a href="#organization"><span class="toc-section-number">1.1</span> Organization</a></li>
<li><a href="#typographic-conventions"><span class="toc-section-number">1.2</span> Typographic Conventions</a></li>
</ul></li>
<li><a href="#introduction"><span class="toc-section-number">2</span> Introduction</a></li>
<li><a href="#quick-start"><span class="toc-section-number">3</span> Quick Start</a><ul>
<li><a href="#prerequisities"><span class="toc-section-number">3.1</span> Prerequisities</a></li>
<li><a href="#procedure-overview"><span class="toc-section-number">3.2</span> Procedure Overview</a></li>
</ul></li>
<li><a href="#command-line-client-installation"><span class="toc-section-number">4</span> Command Line Client Installation</a><ul>
<li><a href="#prerequisites"><span class="toc-section-number">4.1</span> Prerequisites</a><ul>
<li><a href="#python"><span class="toc-section-number">4.1.1</span> Python</a></li>
<li><a href="#ssh-setup"><span class="toc-section-number">4.1.2</span> SSH Setup</a><ul>
<li><a href="#linuxunix"><span class="toc-section-number">4.1.2.1</span> Linux/UNIX</a></li>
<li><a href="#windows"><span class="toc-section-number">4.1.2.2</span> Windows</a></li>
</ul></li>
</ul></li>
<li><a href="#individual-client-installation"><span class="toc-section-number">4.2</span> Individual Client Installation</a></li>
<li><a href="#system-wide-client-installation"><span class="toc-section-number">4.3</span> System Wide Client Installation</a></li>
<li><a href="#client-configuration"><span class="toc-section-number">4.4</span> Client Configuration</a><ul>
<li><a href="#credentials"><span class="toc-section-number">4.4.1</span> Credentials</a></li>
<li><a href="#configuration-file"><span class="toc-section-number">4.4.2</span> Configuration file</a><ul>
<li><a href="#linuxunix-1"><span class="toc-section-number">4.4.2.1</span> Linux/UNIX</a></li>
<li><a href="#windows-1"><span class="toc-section-number">4.4.2.2</span> Windows</a></li>
</ul></li>
</ul></li>
<li><a href="#providing-user-parameters"><span class="toc-section-number">4.5</span> Providing user parameters</a></li>
<li><a href="#cloud-endpoint"><span class="toc-section-number">4.6</span> Cloud Endpoint</a></li>
<li><a href="#persistent-disk-service"><span class="toc-section-number">4.7</span> Persistent Disk service</a></li>
<li><a href="#marketplace"><span class="toc-section-number">4.8</span> Marketplace</a></li>
<li><a href="#privatepublic-keys"><span class="toc-section-number">4.9</span> Private/Public keys</a><ul>
<li><a href="#ssh"><span class="toc-section-number">4.9.1</span> SSH</a></li>
<li><a href="#pem"><span class="toc-section-number">4.9.2</span> PEM</a></li>
<li><a href="#pkcs12"><span class="toc-section-number">4.9.3</span> PKCS12</a></li>
</ul></li>
<li><a href="#custom-sections-in-configuration-file"><span class="toc-section-number">4.10</span> Custom sections in configuration file</a></li>
</ul></li>
<li><a href="#web-interfaces"><span class="toc-section-number">5</span> Web Interfaces</a></li>
<li><a href="#virtual-machine-lifecycle"><span class="toc-section-number">6</span> Virtual Machine Lifecycle</a><ul>
<li><a href="#using-the-cli"><span class="toc-section-number">6.1</span> Using the CLI</a><ul>
<li><a href="#launch"><span class="toc-section-number">6.1.1</span> Launch</a></li>
<li><a href="#connect"><span class="toc-section-number">6.1.2</span> Connect</a></li>
<li><a href="#terminate"><span class="toc-section-number">6.1.3</span> Terminate</a></li>
</ul></li>
</ul></li>
<li><a href="#storage-management"><span class="toc-section-number">7</span> Storage Management</a><ul>
<li><a href="#create-persistent-disk"><span class="toc-section-number">7.1</span> Create persistent disk</a></li>
<li><a href="#list-persistent-disks"><span class="toc-section-number">7.2</span> List persistent disks</a></li>
<li><a href="#using-persistent-disks"><span class="toc-section-number">7.3</span> Using Persistent Disks</a><ul>
<li><a href="#launch-vm-with-a-persistent-disk-attached"><span class="toc-section-number">7.3.1</span> Launch VM with a persistent disk attached</a></li>
<li><a href="#format-attached-disk"><span class="toc-section-number">7.3.2</span> Format attached disk</a></li>
<li><a href="#mount-disk-store-data-unmount-disk"><span class="toc-section-number">7.3.3</span> Mount disk, store data, unmount disk</a></li>
<li><a href="#launch-vm-with-the-modified-persistent-disk-attached"><span class="toc-section-number">7.3.4</span> Launch VM with the modified persistent disk attached</a></li>
</ul></li>
<li><a href="#hot-plug-persistent-disks"><span class="toc-section-number">7.4</span> Hot-plug Persistent Disks</a></li>
<li><a href="#delete-persistent-disks"><span class="toc-section-number">7.5</span> Delete Persistent Disks</a></li>
</ul></li>
<li><a href="#image-management"><span class="toc-section-number">8</span> Image Management</a></li>
<li><a href="#programmatic-access"><span class="toc-section-number">9</span> Programmatic Access</a><ul>
<li><a href="#libcloud-api"><span class="toc-section-number">9.1</span> Libcloud API</a><ul>
<li><a href="#installing-the-driver"><span class="toc-section-number">9.1.1</span> Installing the Driver</a></li>
<li><a href="#configuring-the-stratuslab-client"><span class="toc-section-number">9.1.2</span> Configuring the StratusLab Client</a></li>
<li><a href="#using-the-driver"><span class="toc-section-number">9.1.3</span> Using the Driver</a></li>
<li><a href="#driver-status"><span class="toc-section-number">9.1.4</span> Driver Status</a></li>
</ul></li>
<li><a href="#stratuslab-api"><span class="toc-section-number">9.2</span> StratusLab API</a></li>
<li><a href="#cimi-api"><span class="toc-section-number">9.3</span> CIMI API</a></li>
</ul></li>
</ul>
</nav>
<h1 id="preface"><a href="#TOC"><span class="header-section-number">1</span> Preface</a></h1>
<h2 id="organization"><a href="#TOC"><span class="header-section-number">1.1</span> Organization</a></h2>
<h2 id="typographic-conventions"><a href="#TOC"><span class="header-section-number">1.2</span> Typographic Conventions</a></h2>
<h1 id="introduction"><a href="#TOC"><span class="header-section-number">2</span> Introduction</a></h1>
<p>Describe all of the services and how they fit together. Provide an overall view of a cloud deployment and the terminology.</p>
<p>The tools for end-users include:</p>
<ul>
<li>Pyton CLI client</li>
<li>Web interface</li>
<li>SlipStream</li>
</ul>
<p>Programmatic access to the StratusLab service for application and platform developers includes:</p>
<ul>
<li>StratusLab python API</li>
<li>Libcloud API</li>
<li>Direct use of REST interfaces (CIMI)</li>
</ul>
<h1 id="quick-start"><a href="#TOC"><span class="header-section-number">3</span> Quick Start</a></h1>
<p>How to get up and running as quickly as possible with the command line client.</p>
<h2 id="prerequisities"><a href="#TOC"><span class="header-section-number">3.1</span> Prerequisities</a></h2>
<ul>
<li>Existing installation of virtualenv and pip</li>
<li>Availability of SSH client</li>
<li>SSH key pair</li>
<li>Active StratusLab account</li>
</ul>
<h2 id="procedure-overview"><a href="#TOC"><span class="header-section-number">3.2</span> Procedure Overview</a></h2>
<ul>
<li>Installation of python CLI client</li>
<li>Searching the Marketplace</li>
<li>Running a virtual machine</li>
<li>Creating and using a disk</li>
</ul>
<h1 id="command-line-client-installation"><a href="#TOC"><span class="header-section-number">4</span> Command Line Client Installation</a></h1>
<p>StratusLab provides a simple command line client that is easy to install on all platforms. This client provides access to all of the StratusLab services; it provides a scriptable alternative to access via a web browser.</p>
<p>After installation and configuration of the client follow the instructions to <a href="/try/2012/01/01/try-launch-vm.html">launch a Virtual Machine</a> and then, read the in-depth <a href="/documentation">documentation</a> on the use of the StratusLab cloud.</p>
<h2 id="prerequisites"><a href="#TOC"><span class="header-section-number">4.1</span> Prerequisites</a></h2>
<ul>
<li>Python &gt;= 2.6 and &lt; 3.x</li>
<li>Java 1.6+</li>
<li>SSH client</li>
<li>SSH user key-pair</li>
</ul>
<h3 id="python"><a href="#TOC"><span class="header-section-number">4.1.1</span> Python</a></h3>
<p>Ensure that you have a recent version of Python <strong>&gt;= 2.6</strong>, but &lt; <strong>3.0</strong> installed on your system. From the command line type</p>
<pre><code>$ python -V
  Python 2.6.1</code></pre>
<p>See the <a href="http://python.org/">python site</a> for Python downloads and instructions.</p>
<h3 id="ssh-setup"><a href="#TOC"><span class="header-section-number">4.1.2</span> SSH Setup</a></h3>
<p>In most of the cases SSH will be used to log into virtual machines that have been started in the cloud. Ensure that you have SSH public and private key pair.</p>
<h4 id="linuxunix"><a href="#TOC"><span class="header-section-number">4.1.2.1</span> Linux/UNIX</a></h4>
<p>The private and public keys are usually located under <code>~/.ssh/</code> and have names like <code>id_rsa</code> and <code>id_rsa.pub</code>.</p>
<p>You can generate them with the following command</p>
<pre><code>$ ssh-keygen</code></pre>
<p>The default values are appropriate in most cases, but you should provide a passphrase and not leave it empty.</p>
<p>Verify the generated key pair permissions. The <code>id_rsa</code> should have permissions 0600 (read/write access for owner only) and the <code>id_rsa.pub</code> - 0644 (read access for all; write access for owner).</p>
<p><strong>Be sure to remember the passphrase that you have used!</strong></p>
<p>Be careful if an ssh agent is configured by default for your operating system. Ensure that it is setup to use the correct key and that it provides the correct password for that key.</p>
<h4 id="windows"><a href="#TOC"><span class="header-section-number">4.1.2.2</span> Windows</a></h4>
<ul>
<li>You need to generate an SSH key pair on a linux or Unix system.</li>
<li>Import the private key into Putty</li>
</ul>
<p>To generate an SSH key pair on a linux or Unix system, follow the above instructions described in the Linux/UNIX part above. In your Windows machine, install Putty and PuttyGen from <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">page</a>.</p>
<p>To import your id_rsa file to Putty: 1. Start PuttyGen, 2. Click &quot;Load&quot;, and browse to your id_rsa file, 3. Click &quot;Save private key&quot;. Your private key will be saved in the format required by Putty.</p>
<p>To log in your virtual machine using Putty: 1. Start Putty, 2. In &quot;session&quot; category provide the Host Name or IP address 3. In Connection/SSh/Auth category, in &quot;Private key for authentication&quot; field, browse to your private key. 4. Open</p>
<p>More information on how to &quot;Connecting to Linux/UNIX Instances from Windows Using PuTTY&quot; can be found on this <a href="http://docs.amazonwebservices.com/AWSEC2/latest/UserGuide/putty.html">page</a></p>
<h2 id="individual-client-installation"><a href="#TOC"><span class="header-section-number">4.2</span> Individual Client Installation</a></h2>
<p>Look for the latest version of the command-line client tarball <code>stratuslab-cli-user-*.tar.gz</code> in the <a href="http://yum.stratuslab.eu/releases/centos-6.2/">yum repositories</a>. (Even though this is a CentOS repository, <strong>all of the tarballs and zip files work on all platforms</strong>.) Unpack the tarball in a convenient location.</p>
<p>Update your <code>PATH</code> and <code>PYTHONPATH</code> variables:</p>
<pre><code>export PATH=$PATH:&lt;install location&gt;/bin
export PYTHONPATH=$PYTHONPATH:&lt;install location&gt;/lib/stratuslab/python</code></pre>
<p>The above are appropriate for Bourne-type shells. Modify the commands as necessary if you are using a different shell.</p>
<h2 id="system-wide-client-installation"><a href="#TOC"><span class="header-section-number">4.3</span> System Wide Client Installation</a></h2>
<p>These packages only work on RedHat Enterprise Linux systems (and its derivatives like CentOS and ScientificLinux) and OpenSuSE. You must have root access to your machine to install them.</p>
<p>For RHEL and RHEL-like systems, it is recommended to do the installation with <a href="http://yum.baseurl.org/">yum</a>. The configuration for yum can be found <a href="http://yum.stratuslab.eu/">here</a>, choosing the &quot;centos-6.2&quot; repository. Execute:</p>
<pre><code>$ yum install stratuslab-cli-user</code></pre>
<p>to install the latest version of the client tools.</p>
<p>For OpenSuSE, configure zypper for the StratusLab OpenSuSE repository (&quot;opensuse-12.1&quot;) and use it to install the package.</p>
<h2 id="client-configuration"><a href="#TOC"><span class="header-section-number">4.4</span> Client Configuration</a></h2>
<p>One has to know at least one endpoint of the StratusLab cloud deployment and possess valid credentials to access it. Refer to <a href="/try/2012/12/04/try-reference-cloud-infrastructures.html">StratusLab Reference infrastructure</a>.</p>
<h3 id="credentials"><a href="#TOC"><span class="header-section-number">4.4.1</span> Credentials</a></h3>
<p>For working with user command-line tools one needs to possess the following credentials (requirement depends on use-case and utility used)</p>
<pre><code>username/password of the account in StratusLab Cloud frontend(s)
X509 key/pair
Globus/VOMS proxy
PKCS12 certificate</code></pre>
<p>For more see <a href="/documentation/2012/10/05/docs-tutor-user-credentials.html">documentation on user credentials</a>.</p>
<h3 id="configuration-file"><a href="#TOC"><span class="header-section-number">4.4.2</span> Configuration file</a></h3>
<p>Configuration file should contain definitions of StratusLab services endpoints and credentials required for the user client. For example</p>
<pre><code>endpoint = cloud.lal.stratuslab.eu
pdisk_endpoint = pdisk.lal.stratuslab.eu
username = clouduser
password = cloudpass
pem_certificate = /Users/localuser/.globus/usercert.pem
pem_key = /Users/localuser/.globus/userkey.pem</code></pre>
<h4 id="linuxunix-1"><a href="#TOC"><span class="header-section-number">4.4.2.1</span> Linux/UNIX</a></h4>
<p>By default the user client expects the configuration file at <code>$HOME/.stratuslab/stratuslab-user.cfg</code>.</p>
<p>The client ships with a reference configuration file</p>
<ul>
<li>in tarball &lt;install location&gt;/conf/stratuslab-user.cfg.ref</li>
<li>in RPM /etc/stratuslab/stratuslab-user.cfg.ref</li>
</ul>
<p>User has to copy the file to the default location <code>$HOME/.stratuslab/stratuslab-user.cfg</code> and modify it following explanations to the variables in the file. The variables that are commented out (e.g. p12_certificate) take their default values from the code.</p>
<h4 id="windows-1"><a href="#TOC"><span class="header-section-number">4.4.2.2</span> Windows</a></h4>
<p>By default the user client expects the configuration file at <code>%HOMEDRIVE%%HOMEPATH%\.stratuslab\stratuslab-user.cfg</code>.</p>
<pre><code>mkdir %HOMEDRIVE%%HOMEPATH%\.stratuslab</code></pre>
<p>The reference configuration file</p>
<ul>
<li>in zip package <code>&lt;install location&gt;\conf\stratuslab-user.cfg.ref</code></li>
</ul>
<p>User has to copy the file to the default location <code>%HOMEDRIVE%%HOMEPATH%\.stratuslab\stratuslab-user.cfg</code> and modify it following explanations to the variables in the file. The variables that are commented out (e.g. p12_certificate) take their default values from the code.</p>
<h2 id="providing-user-parameters"><a href="#TOC"><span class="header-section-number">4.5</span> Providing user parameters</a></h2>
<p>The following are they means of providing user parameters and presented in the order of precedence</p>
<ul>
<li>via command line parameters</li>
<li>via environment variables (STRATUSLAB_*)</li>
<li>in configuration file (by default: HOME/.stratuslab/stratuslab-user.cfg)</li>
<li>default in the code</li>
</ul>
<h2 id="cloud-endpoint"><a href="#TOC"><span class="header-section-number">4.6</span> Cloud Endpoint</a></h2>
<p>Used for VMs instantiation. There is no default value for the endpoint in the code.</p>
<p>Command-line parameters</p>
<pre><code>--endpoint
--username
--password</code></pre>
<p>Environment variables</p>
<pre><code>STRATUSLAB_ENDPOINT
STRATUSLAB_USERNAME
STRATUSLAB_PASSWORD</code></pre>
<p>Configuration file</p>
<pre><code>endpoint
username
password</code></pre>
<h2 id="persistent-disk-service"><a href="#TOC"><span class="header-section-number">4.7</span> Persistent Disk service</a></h2>
<p>Used for manipulation machine and disk images (create, delete, hot-attach/detach) in the Persisten Disk storage service. There is no default for PDisk endpoint in the code. If not provided, the client will use the value of 'endpoint'.</p>
<p>Command-line parameters</p>
<pre><code>--pdisk-endpoint
--pdisk-username
--pdisk-password</code></pre>
<p>Environment variables</p>
<pre><code>STRATUSLAB_PDISK_ENDPOINT
STRATUSLAB_PDISK_PROTOCOL  # default &#39;https&#39;
STRATUSLAB_PDISK_PORT      # default &#39;8445&#39;
STRATUSLAB_PDISK_USERNAME
STRATUSLAB_PDISK_PASSWORD</code></pre>
<p>Configuration file</p>
<pre><code>pdisk_endpoint
pdisk_port</code></pre>
<p>NB! If 'pdisk-username' and/or 'pdisk-password' are not provided by any of the means the ones defined for 'endpoint' will be used.</p>
<h2 id="marketplace"><a href="#TOC"><span class="header-section-number">4.8</span> Marketplace</a></h2>
<p>Marketplace endpoint to be used when uploading metadata, and/or when creating instance of VM.</p>
<p>Default value for Marketplace endpoint in the code</p>
<pre><code>https://marketplace.stratuslab.eu</code></pre>
<p>Command-line parameter</p>
<pre><code>--marketplace-endpoint</code></pre>
<p>Environment variable</p>
<pre><code>STRATUSLAB_MARKETPLACE_ENDPOINT</code></pre>
<p>Configuration file</p>
<pre><code>marketplace_endpoint</code></pre>
<h2 id="privatepublic-keys"><a href="#TOC"><span class="header-section-number">4.9</span> Private/Public keys</a></h2>
<h3 id="ssh"><a href="#TOC"><span class="header-section-number">4.9.1</span> SSH</a></h3>
<p>SSH public key file. Used at VM instantiation. The public key is pushed to the VM to enable password-less SSH access. Default: <strong>HOME/.ssh/id_rsa.pub</strong>.</p>
<p>Command-line parameter</p>
<pre><code>--key</code></pre>
<p>Environment variable</p>
<pre><code>STRATUSLAB_KEY</code></pre>
<p>Configuration file</p>
<pre><code>user_public_key_file</code></pre>
<h3 id="pem"><a href="#TOC"><span class="header-section-number">4.9.2</span> PEM</a></h3>
<p>Used to authenticate to the cloud endpoint. If you want to use authentication with grid certificate and if username/password and PEM key/cert are both enabled, PEM key/cert takes precedence.</p>
<p>Default: <strong>HOME/.globus/userkey.pem</strong>, <strong>HOME/.globus/usercert.pem</strong></p>
<p>Command-line parameters</p>
<pre><code>--pem-cert
--pem-key</code></pre>
<p>Environment variables</p>
<pre><code>STRATUSLAB_PEM_CERTIFICATE
STRATUSLAB_PEM_KEY</code></pre>
<p>Configuration file</p>
<pre><code>pem_key
pem_certificate</code></pre>
<h3 id="pkcs12"><a href="#TOC"><span class="header-section-number">4.9.3</span> PKCS12</a></h3>
<p>PKSC12-formatted certificate, for signing and validating image metadata.</p>
<p>Default: <strong>HOME/.globus/usercert.p12</strong></p>
<p>Command-line parameters</p>
<pre><code>--p12-cert
--p12-password</code></pre>
<p>Environment variables</p>
<pre><code>STRATUSLAB_P12_CERTIFICATE
STRATUSLAB_P12_PASSWORD</code></pre>
<p>Configuration file</p>
<pre><code>p12_certificate
p12_password</code></pre>
<h2 id="custom-sections-in-configuration-file"><a href="#TOC"><span class="header-section-number">4.10</span> Custom sections in configuration file</a></h2>
<p>In the configuration file it is possible to create uniquely named user specific sections to define any of the variables described above. Example of 'endpoint'</p>
<pre><code>[my-section]
endpoint = &lt;another.cloud.frontend.hostname&gt;
username = &lt;another.username&gt;
password = &lt;another.password&gt;</code></pre>
<p>which can be activated using the <strong>selected_section</strong> parameter in the <strong>default</strong> section of the configuration file</p>
<pre><code>selected_section = my-section</code></pre>
<p>or using command-line option</p>
<pre><code>--user-config-section or -S</code></pre>
<p>or using environment variable</p>
<pre><code>STRATUSLAB_USER_CONFIG_SECTION</code></pre>
<p>Example. Configuration file defines custom 'fav-cloud' section with endpoint/credentials and custom SSH key</p>
<pre><code>[fav-cloud]
endpoint = favorit-cloud.tld
username = clouduser
password = cloudpass
user_public_key_file = /home/clouduser/.ssh/id_rsa-favcloud.pub</code></pre>
<p>Launch a ttylinux image on the cloud endpoint defined by 'fav-cloud' section</p>
<pre><code>stratus-run-instance -S fav-cloud $TTYLINUX_IMAGE</code></pre>
<h1 id="web-interfaces"><a href="#TOC"><span class="header-section-number">5</span> Web Interfaces</a></h1>
<ul>
<li>Marketplace</li>
<li>Storage</li>
</ul>
<h1 id="virtual-machine-lifecycle"><a href="#TOC"><span class="header-section-number">6</span> Virtual Machine Lifecycle</a></h1>
<h2 id="using-the-cli"><a href="#TOC"><span class="header-section-number">6.1</span> Using the CLI</a></h2>
<h3 id="launch"><a href="#TOC"><span class="header-section-number">6.1.1</span> Launch</a></h3>
<p><a href="/try/2012/01/10/try-user-cli-installation.html">Configure</a> Cloud endpoint and credentials in the configuration file (default: <code>$HOME/.stratuslab/stratuslab-user.cfg</code>).</p>
<p>Search for an image in <a href="https://marketplace.stratuslab.eu">StratusLab Marketplace</a> and copy the image <strong>identifier</strong>. Say we searched for <strong>ttylinux</strong> and chose <strong><a href="https://marketplace.stratuslab.eu/metadata/BN1EEkPiBx87_uLj2-sdybSI-Xb">BN1EEkPiBx87_uLj2-sdybSI-Xb</a></strong>.</p>
<p>Launch an instance of the image</p>
<pre><code>$ stratus-run-instance BN1EEkPiBx87_uLj2-sdybSI-Xb

  :::::::::::::::::::::::::
  :: Starting machine(s) ::
  :::::::::::::::::::::::::
  :: Starting 1 machine
  :: Machine 1 (vm ID: 5507)
         Public ip: 134.158.75.75
  :: Done!</code></pre>
<h3 id="connect"><a href="#TOC"><span class="header-section-number">6.1.2</span> Connect</a></h3>
<p>Check the VM is up and running</p>
<pre><code>$ stratus-describe-instance 5507
id   state     vcpu memory    cpu% host/ip                 name
5507 Running   1    131072    4    vm-75.lal.stratuslab.eu one-5507</code></pre>
<p>Connect to the VM</p>
<pre><code>$ ssh root@vm-75.lal.stratuslab.eu
# uname -a
Linux ttylinux_host 2.6.38.1 #1 SMP PREEMPT Tue Apr 10 21:55:48 MST 2012 x86_64 GNU/Linux
# logout
Connection to vm-75.lal.stratuslab.eu closed.
$</code></pre>
<h3 id="terminate"><a href="#TOC"><span class="header-section-number">6.1.3</span> Terminate</a></h3>
<pre><code>$ stratus-kill-instance 5507</code></pre>
<h1 id="storage-management"><a href="#TOC"><span class="header-section-number">7</span> Storage Management</a></h1>
<p>Persistent Disk Storage is the StratusLab service that physically stores machine and disk images as volumes on the cloud site. It facilitates quick startup of VMs and hot-plugging of disk volumes as block devices to the VMs.</p>
<h2 id="create-persistent-disk"><a href="#TOC"><span class="header-section-number">7.1</span> Create persistent disk</a></h2>
<p>Before creating persistent disks (or volumes)<sup><a href="#fn1" class="footnoteRef" id="fnref1">1</a></sup>, you should define the persistent disk storage endpoint by either of</p>
<ul>
<li>in your HOME/.stratuslab/stratuslab-user.cfg</li>
<li>set the environment variable STRATUSLAB_PDISK_ENDPOINT</li>
<li>pass it as <strong><em>-</em>-pdisk-endpoint</strong> command when creating one.</li>
</ul>
<p>Lets create a persistent disk of 5GB and named &quot;myprivate-disk&quot;</p>
<pre><code>$ stratus-create-volume --size=5 --tag=myprivate-disk
DISK 9c5a2c03-8243-4a1b-a248-0f0d22d948c2</code></pre>
<p>The command returned the UUID of the created persistent disk. Newly created disk is by default</p>
<ul>
<li>private - can be read, written and deleted only by their owner</li>
<li>of type <strong>read-write data image</strong></li>
</ul>
<p>To create public persistent disk, pass <em>-</em>-public argument to stratus-create-volume</p>
<pre><code>$ stratus-create-volume --public --size=10 --tag=mypublic-disk
DISK d955fda6-bf9c-4aa8-abc4-5bbcdb83021b</code></pre>
<p>or update the disk with</p>
<pre><code>stratus-update-volume --public &lt;UUID&gt;</code></pre>
<p>To get the list of available disk types and the properties that can be updated on the disk run</p>
<pre><code>stratus-update-volume -h</code></pre>
<h2 id="list-persistent-disks"><a href="#TOC"><span class="header-section-number">7.2</span> List persistent disks</a></h2>
<p>stratus-describe-volumes allows you to query the list of all your public and private persistent disks, and also all the public persistent disks created by other users.</p>
<pre><code>$ stratus-describe-volumes 
:: DISK a4324f26-39e0-4965-8c8f-3287cd0936e5
        created: 2011/07/20 16:37:10
        visibility: public
        tag: mypublic-disk
        owner: testor2
        size: 5
        users: 0
:: DISK 9c5a2c03-8243-4a1b-a248-0f0d22d948c2
        created: 2011/07/20 16:10:37
        visibility: private
        tag: myprivate-disk
        owner: testor1
        size: 5
        users: 0
:: DISK d955fda6-bf9c-4aa8-abc4-5bbcdb83021b
        created: 2011/07/20 16:26:31
        visibility: public
        tag: mypublic-disk
        owner: testor1
        size: 5
        users: 0</code></pre>
<p>The above command lists 'testor1' public and private persistent disks, and also 'testor2' public ones.</p>
<h2 id="using-persistent-disks"><a href="#TOC"><span class="header-section-number">7.3</span> Using Persistent Disks</a></h2>
<p>Workflow:</p>
<ul>
<li>Launch a virtual machine instance referencing a persistent disk</li>
<li>Format the disk in the running VM</li>
<li>Write data to the disk</li>
<li>Dismount the disk or halt the machine instance</li>
<li>Disk with persistent data is available for use by another VM</li>
<li>Launch another VM referencing the modified persistent disk</li>
</ul>
<h3 id="launch-vm-with-a-persistent-disk-attached"><a href="#TOC"><span class="header-section-number">7.3.1</span> Launch VM with a persistent disk attached</a></h3>
<p>To Launch a VM we will be using the ttylinux image identifier GOaxJFdoEXvqAm9ArJgnZ0_ky6F from StratusLab Marketplace (default one).</p>
<p><em>-</em>-persistent-disk=UUID option when used with stratus-run-instance, tells StratusLab to attach the referenced persistent disk(UUID) to the VM.</p>
<p>Instantiate ttylinux image with reference to your private persistent disk 9c5a2c03-8243-4a1b-a248-0f0d22d948c2.</p>
<pre><code>$ stratus-run-instance \
    --persistent-disk=9c5a2c03-8243-4a1b-a248-0f0d22d948c2 \
    GOaxJFdoEXvqAm9ArJgnZ0_ky6F

 :::::::::::::::::::::::::
 :: Starting machine(s) ::
 :::::::::::::::::::::::::
 :: Starting 1 machine
 :: Machine 1 (vm ID: 3)
        Public ip: 134.158.75.35</code></pre>
<p>Log into your VM using ssh, depending in the linux kernel and distribution version of your VM, your persistent disk will be referenced as /dev/hdc or /dev/sdc.</p>
<p>In ttylinux, it will be /dev/hdc.</p>
<p>Make sure that your disk was attached to your VM</p>
<pre><code>$ ssh root@134.158.75.35
# fdisk -l 
.........
Disk /dev/hdc: 5368 MB, 5368709120 bytes
255 heads, 63 sectors/track, 652 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
.........</code></pre>
<h3 id="format-attached-disk"><a href="#TOC"><span class="header-section-number">7.3.2</span> Format attached disk</a></h3>
<pre><code># mkfs.ext3 /dev/hdc</code></pre>
<h3 id="mount-disk-store-data-unmount-disk"><a href="#TOC"><span class="header-section-number">7.3.3</span> Mount disk, store data, unmount disk</a></h3>
<pre><code># mount /dev/hdc /mnt
# echo &quot;Testing Persistent Disk&quot; &gt; /mnt/test_pdisk
# umount /mnt </code></pre>
<p>Your persistent disk is ready to be used by another VM.</p>
<h3 id="launch-vm-with-the-modified-persistent-disk-attached"><a href="#TOC"><span class="header-section-number">7.3.4</span> Launch VM with the modified persistent disk attached</a></h3>
<p>Instantiate new VM ttylinux with the same reference to your private persistent disk 9c5a2c03-8243-4a1b-a248-0f0d22d948c2.</p>
<pre><code>$ stratus-run-instance \
    --persistent-disk=9c5a2c03-8243-4a1b-a248-0f0d22d948c2 \
    GOaxJFdoEXvqAm9ArJgnZ0_ky6F

 :::::::::::::::::::::::::
 :: Starting machine(s) ::
 :::::::::::::::::::::::::
 :: Starting 1 machine
 :: Machine 1 (vm ID: 4)
        Public ip: 134.158.75.36</code></pre>
<p>Log into your VM using ssh, verify existence of your persistent disk</p>
<pre><code>$ ssh root@134.158.75.35
# fdisk -l
...........
Disk /dev/hdc: 5368 MB, 5368709120 bytes
255 heads, 63 sectors/track, 652 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
...........</code></pre>
<p>Mount your persistent disk</p>
<pre><code># mount /dev/hdc /mnt
# ls /mnt
lost+found  test_pdisk
# cat /mnt/test_pdisk 
Testing Persistent Disk</code></pre>
<h2 id="hot-plug-persistent-disks"><a href="#TOC"><span class="header-section-number">7.4</span> Hot-plug Persistent Disks</a></h2>
<p>StratusLab storage also provides hot-plug feature for persistent disk. With stratus-attach-instance you can attach a volume to a running machine and with stratus-detach-instance you can release it.</p>
<p>To use the hot-plug feature, the running instance needs to have acpiphp kernel module loaded. Image like ttylinux doesn't have this feature, you have to use base image like Ubuntu, CentOS or Fedora.</p>
<p>Before hot-plugin a disk, make sure acpiphp is loaded. In your VM execute</p>
<pre><code>modprobe acpiphp</code></pre>
<p>To attach two volumes to the VM ID 24 with the UUIDs 1e8e9104-681c-4269-8aae-e513c6723ac6 and<br>5822c376-9ce1-434e-95d1-cdaa240cd47c</p>
<pre><code>$ stratus-attach-volume -i 24 1e8e9104-681c-4269-8aae-e513c6723ac6 5822c376-9ce1-434e-95d1-cdaa240cd47c
ATTACHED 1e8e9104-681c-4269-8aae-e513c6723ac6 in VM 24 on /dev/vda
ATTACHED 5822c376-9ce1-434e-95d1-cdaa240cd47c in VM 24 on /dev/vdb  </code></pre>
<p>Use the fdisk -l command as above to see the newly attached disks.</p>
<p>Make sure to unmount any file systems on the device within your operating system before detaching the volume. Failure to unmount file systems, or otherwise properly release the device from use, can result in lost data and will corrupt the file system.</p>
<pre><code>umount /dev/vda
umount /dev/vdb</code></pre>
<p>When you finish using your disks, you can detach them from the running VM</p>
<pre><code>$ stratus-detach-volume -i 24 1e8e9104-681c-4269-8aae-e513c6723ac6 5822c376-9ce1-434e-95d1-cdaa240cd47c
DETACHED 1e8e9104-681c-4269-8aae-e513c6723ac6 from VM 24 on /dev/vda
DETACHED 5822c376-9ce1-434e-95d1-cdaa240cd47c from VM 24 on /dev/vdb</code></pre>
<p>On running instance detaching not hot-plugged disks or disks that were not or are no longer attached to the instance will result in an error</p>
<pre><code>$ stratus-detach-volume -i 41 2a17226f-b006-45d8-930e-13fbef3c6cdc
DISK 2a17226f-b006-45d8-930e-13fbef3c6cdc: Disk have not been hot-plugged</code></pre>
<p>If you have attached the volume at instance start-up, it cannot be detached while the instance is in the 'Running' state. To detach the volume, stop the instance first.</p>
<h2 id="delete-persistent-disks"><a href="#TOC"><span class="header-section-number">7.5</span> Delete Persistent Disks</a></h2>
<p>To delete a persistent disk use the stratus-delete-volume command, note that you can delete only your disks.</p>
<p>To delete 'myprivate-disk' with UUID 9c5a2c03-8243-4a1b-a248-0f0d22d948c2</p>
<pre><code>$ stratus-delete-volume 9c5a2c03-8243-4a1b-a248-0f0d22d948c2
DELETED 9c5a2c03-8243-4a1b-a248-0f0d22d948c2</code></pre>
<p>Check that the disk is no longer there</p>
<pre><code>$ stratus-describe-volumes 
:: DISK a4324f26-39e0-4965-8c8f-3287cd0936e5
        created: 2011/07/20 16:37:10
        visibility: public
        tag: mypublic-disk
        owner: testor2
        users: 0
        size: 5
:: DISK d955fda6-bf9c-4aa8-abc4-5bbcdb83021b
        created: 2011/07/20 16:26:31
        visibility: public
        tag: mypublic-disk
        owner: testor1
        users: 1
        size: 5</code></pre>
<p>Now try to delete 'mypublic-disk' of 'testor2' user persistent disk</p>
<pre><code>$ stratus-delete-volume a4324f26-39e0-4965-8c8f-3287cd0936e5
  [ERROR] Service error: Not enough rights to delete disk</code></pre>
<h1 id="image-management"><a href="#TOC"><span class="header-section-number">8</span> Image Management</a></h1>
<p>Overall view of the Marketplace and how it works.</p>
<p>Describe also the image creation methods and process.</p>
<h1 id="programmatic-access"><a href="#TOC"><span class="header-section-number">9</span> Programmatic Access</a></h1>
<p>How to use the various StratusLab APIs.</p>
<h2 id="libcloud-api"><a href="#TOC"><span class="header-section-number">9.1</span> Libcloud API</a></h2>
<p>The Libcloud API provides a generic python interface for controlling cloud resources from multiple providers. StratusLab now provides a Libcloud compute driver allowing users to access StratusLab cloud infrastructures via this API.</p>
<h3 id="installing-the-driver"><a href="#TOC"><span class="header-section-number">9.1.1</span> Installing the Driver</a></h3>
<p>The driver is intended to be installed with pip. You should be able to simply do the following:</p>
<pre><code>pip install stratuslab-libcloud-drivers</code></pre>
<p>which will install the StratusLab Libcloud driver, Libcloud itself (0.12.1), and the StratusLab client. If you want to use the <code>deploy_node()</code> function, you'll also need to install paramiko, a python SSH library, as well.</p>
<pre><code>pip install paramiko</code></pre>
<p>If pip is configured to do system-wide installations, then the PYTHONPATH and PATH should already be set correctly. If it is setup for user area installations, you will likely need to set these variables by hand.</p>
<p>You can download the package directly from <a href="http://pypi.python.org/">PyPi</a>. The name of the package is &quot;stratuslab-libcloud-drivers&quot;. You will also need to download and install all of the dependencies. <strong>Using pip is very strongly recommended.</strong></p>
<h3 id="configuring-the-stratuslab-client"><a href="#TOC"><span class="header-section-number">9.1.2</span> Configuring the StratusLab Client</a></h3>
<p>The Libcloud drivers for StratusLab use the same configuration file as for the command line client.</p>
<p>To copy a reference configuration file into place, use the command <code>stratus-copy-config</code> to copy an example configuration file into place. The command will print the location of your configuration file. The example configuration file contains extensive documentation on the parameters. Edit the file and put in your credentials and cloud endpoints.</p>
<p>More detailed documentation can be found in the <a href="http://stratuslab.eu/documentation/">StratusLab documentation</a> area on the website.</p>
<h3 id="using-the-driver"><a href="#TOC"><span class="header-section-number">9.1.3</span> Using the Driver</a></h3>
<p>Once you've downloaded, installed, and configured the necessary dependencies, you are ready to start using the driver.</p>
<p>From the Python interactive shell do the following:</p>
<pre><code>from libcloud.compute.providers import set_driver

set_driver(&#39;STRATUSLAB&#39;, 
           &#39;stratuslab.libcloud.compute_driver&#39;,
           &#39;StratusLabNodeDriver&#39;)</code></pre>
<p>This registers the driver with the Libcloud library. This import must be done <strong>before</strong> asking Libcloud to use the driver! Once this is done, then the driver can be used like any other Libcloud driver.</p>
<pre><code># Obtain an instance of the StratusLab driver. 
from libcloud.compute.types import Provider
from libcloud.compute.providers import get_driver
StratusLabDriver = get_driver(&#39;stratuslab&#39;)
driver = StratusLabDriver(&#39;default&#39;)

# Use the Libcloud methods to find, create and control nodes.
nodes = driver.list_nodes()</code></pre>
<p>There are a couple examples in the test area of the GitHub repository for this driver <a href="https://github.com/StratusLab/libcloud-drivers/tree/master/test">lc-sl-examples</a>. You can also find general information on the Apache Libcloud website.</p>
<h3 id="driver-status"><a href="#TOC"><span class="header-section-number">9.1.4</span> Driver Status</a></h3>
<p>This driver is currently a prototype and of beta quality. This driver is probably <em>not</em> suitable for production.</p>
<p>The driver is functionally complete and should work with all of the standard Libcloud workflows. Problems encountered when using the driver should be reported via the StratusLab support mailing list.</p>
<p>In detail, the following functions have working implementations:</p>
<ul>
<li><code>list_images</code>: list all valid images in Marketplace</li>
<li><code>list_locations</code>: list of sections in configuration file</li>
<li><code>list_sizes</code>: list of standard machine instance types</li>
<li><code>create_node</code>: start a virtual machine</li>
<li><code>deploy_node</code>: start a VM and run a script (see notes below)</li>
<li><code>destroy_node</code>: terminate a virtual machine</li>
<li><code>list_nodes</code>: list of active virtual machines</li>
<li><code>create_volume</code>: create persistent disk</li>
<li><code>destroy_volume</code>: destroy a persistent disk</li>
<li><code>attach_volume</code>: attach a volume to node</li>
<li><code>detach_volume</code>: remove a volume from a node</li>
</ul>
<p>The <code>list_volumes</code> function is specific to the StratusLab driver and is not part of the Libcloud standard abstraction.</p>
<p>The <code>reboot_node</code> function will not be implemented as the required functionality is not provided by a StratusLab cloud.</p>
<p><strong>Notes</strong> for <code>deploy_node</code>:</p>
<ol type="1">
<li><p>The SSH library used by Libcloud seems to only work correctly with DSA SSH keys. You can have both RSA and DSA keys available in parallel.</p></li>
<li><p>This function uses sftp to transfer the script between the client and the virtual machine. Consequently, SSH implementations that do not support sftp will not work. This include, notably, ttylinux.</p></li>
</ol>
<h2 id="stratuslab-api"><a href="#TOC"><span class="header-section-number">9.2</span> StratusLab API</a></h2>
<h2 id="cimi-api"><a href="#TOC"><span class="header-section-number">9.3</span> CIMI API</a></h2>
<section class="footnotes">
<hr>
<ol>
<li id="fn1"><p>&quot;disk&quot; and &quot;volume&quot; are used interchangeably.<a href="#fnref1">↩</a></p></li>
</ol>
</section>
</body>
</html>
