<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<head>
  <title>  StratusLab :: tutorial:baseimagecreationaytoyast  </title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="Author" content="Marcin Mierzejewski @ Zenzire"/>
  <meta name="Keywords" content="StratusLab,tutorial:baseimagecreationaytoyast"/>
  <meta name="Description" content="StratusLabtutorial:baseimagecreationaytoyast"/>
  <meta name="generator" content="DokuWiki" />
<meta name="robots" content="index,follow" />
<meta name="date" content="2012-03-20T14:05:08+0100" />
<meta name="keywords" content="tutorial,baseimagecreationaytoyast" />
<link rel="search" type="application/opensearchdescription+xml" href="../lib/exe/opensearch.php" title="StratusLab" />
<link rel="start" href="../index.html" />
<link rel="contents" href="./tutorial:baseimagecreation.htmlaytoyast?do=index" title="Sitemap" />
<link rel="canonical" href="./tutorial:baseimagecreation.htmlaytoyast" />
<link rel="stylesheet" media="screen" type="text/css" href="../lib/exe/css.php?t=stratuslab-theme&amp;tseed=1349958590" />
<link rel="stylesheet" media="all" type="text/css" href="../lib/exe/css.php?s=all&amp;t=stratuslab-theme&amp;tseed=1349958590" />
<link rel="stylesheet" media="print" type="text/css" href="../lib/exe/css.php?s=print&amp;t=stratuslab-theme&amp;tseed=1349958590" />
<script type="text/javascript" ><!--//--><![CDATA[//><!--
var NS='tutorial';var JSINFO = {"id":"tutorial:baseimagecreationaytoyast","namespace":"tutorial"};
//--><!]]></script>
<script type="text/javascript" charset="utf-8" src="../lib/exe/js.php?tseed=1349958590" ></script>

  <link rel="stylesheet" media="screen" type="text/css" href="../lib/tpl/stratuslab-theme/css/design.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="../lib/tpl/stratuslab-theme/css/gallery.css" />
  <link rel="stylesheet" type="text/css" href="../lib/tpl/stratuslab-theme/css/960.css" media="screen" />

  <script type="text/javascript">

   var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-18570821-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();

</script>
</head>

<body>
  <div class="Page">
		<div class="Header">

			<div class="Banner">
			      </div>

			<div class="MenuContainer"><div class="Menu" id="level1">
<p>

<!-- main menu under the banner -->
<div class="mainmenu">
<span class="menuitem">
<a class="menulink" href="../index.html">Home</a>
</span>
<span class="menuitem">
<a class="menulink" href="./release:install.html">Install</a>
</span>
<span class="menuitem">
<a class="menulink" href="support.html">Support</a>
</span>
<span class="menuitem">
<a class="menulink" href="documentation.html">Documentation</a>
</span>
<span class="menuitem">
<a class="menulink" href="./roadmap:project_roadmap.html">Roadmap</a>
</span>
<span class="menuitem">
<a class="menulink" href="news.html">News</a>
</span>
<span class="menuitem">
<a class="menulink" href="./project:info.html">About</a>
</span>
</div>


</p>
</div><div class="Menu" id="level2"></div>
		</div> 


    	
		<div class="Content">
				
<p>
Below is the autoyast profile that can be used to do an automatic installation of OpenSUSE12.1 with StratusLab contextualization.

</p>
<pre class="code">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE profile&gt;
&lt;profile xmlns=&quot;http://www.suse.com/1.0/yast2ns&quot; xmlns:config=&quot;http://www.suse.com/1.0/configns&quot;&gt;
  &lt;add-on&gt;
    &lt;add_on_products config:type=&quot;list&quot;&gt;
      &lt;listentry&gt;
        &lt;media_url&gt;http://download.opensuse.org/distribution/12.1/repo/oss/suse&lt;/media_url&gt;
        &lt;product&gt;openSUSE 12.1&lt;/product&gt;
        &lt;product_dir&gt;/&lt;/product_dir&gt;
        &lt;ask_on_error config:type=&quot;boolean&quot;&gt;true&lt;/ask_on_error&gt;
        &lt;name&gt;openSUSE 12.1&lt;/name&gt;
      &lt;/listentry&gt;
    &lt;/add_on_products&gt;
  &lt;/add-on&gt;
  &lt;bootloader&gt;
    &lt;activate config:type=&quot;boolean&quot;&gt;false&lt;/activate&gt;
    &lt;loader_type&gt;grub&lt;/loader_type&gt;
    &lt;location&gt;mbr&lt;/location&gt;
    &lt;repl_mbr config:type=&quot;boolean&quot;&gt;true&lt;/repl_mbr&gt;
    &lt;sections config:type=&quot;list&quot;/&gt;
  &lt;/bootloader&gt;
  &lt;firewall&gt;
    &lt;enable_firewall config:type=&quot;boolean&quot;&gt;false&lt;/enable_firewall&gt;
    &lt;start_firewall config:type=&quot;boolean&quot;&gt;false&lt;/start_firewall&gt;
  &lt;/firewall&gt;
  &lt;general&gt;
    &lt;mode&gt;
      &lt;confirm config:type=&quot;boolean&quot;&gt;false&lt;/confirm&gt;
    &lt;/mode&gt;
    &lt;signature-handling&gt;
      &lt;accept_file_without_checksum config:type=&quot;boolean&quot;&gt;false&lt;/accept_file_without_checksum&gt;
      &lt;accept_unknown_gpg_key config:type=&quot;boolean&quot;&gt;false&lt;/accept_unknown_gpg_key&gt;
      &lt;accept_unsigned_file config:type=&quot;boolean&quot;&gt;false&lt;/accept_unsigned_file&gt;
      &lt;accept_verification_failed config:type=&quot;boolean&quot;&gt;false&lt;/accept_verification_failed&gt;
      &lt;import_gpg_key config:type=&quot;boolean&quot;&gt;false&lt;/import_gpg_key&gt;
    &lt;/signature-handling&gt;
  &lt;/general&gt;
  &lt;groups config:type=&quot;list&quot;/&gt;
  &lt;keyboard&gt;
    &lt;keymap&gt;us&lt;/keymap&gt;
  &lt;/keyboard&gt;
  &lt;language&gt;
    &lt;language&gt;en_US&lt;/language&gt;
  &lt;/language&gt;
   &lt;networking&gt;
    &lt;dhcp_options&gt;
      &lt;dhclient_hostname_option&gt;AUTO&lt;/dhclient_hostname_option&gt;
    &lt;/dhcp_options&gt;
    &lt;interfaces config:type=&quot;list&quot;&gt;
      &lt;interface&gt;
        &lt;bootproto&gt;dhcp&lt;/bootproto&gt;
        &lt;device&gt;eth0&lt;/device&gt;
        &lt;startmode&gt;auto&lt;/startmode&gt;
        &lt;usercontrol&gt;no&lt;/usercontrol&gt;
      &lt;/interface&gt;
    &lt;/interfaces&gt;
  &lt;/networking&gt;
    &lt;partitioning config:type=&quot;list&quot;&gt;
    &lt;drive&gt;
      &lt;device&gt;/dev/sda&lt;/device&gt;
      &lt;initialize config:type=&quot;boolean&quot;&gt;true&lt;/initialize&gt;
      &lt;partitions config:type=&quot;list&quot;&gt;
        &lt;partition&gt;
          &lt;create config:type=&quot;boolean&quot;&gt;true&lt;/create&gt;
          &lt;crypt_fs config:type=&quot;boolean&quot;&gt;false&lt;/crypt_fs&gt;
          &lt;filesystem config:type=&quot;symbol&quot;&gt;ext4&lt;/filesystem&gt;
          &lt;format config:type=&quot;boolean&quot;&gt;true&lt;/format&gt;
          &lt;fstopt&gt;acl,user_xattr&lt;/fstopt&gt;
          &lt;loop_fs config:type=&quot;boolean&quot;&gt;false&lt;/loop_fs&gt;
          &lt;mount&gt;/&lt;/mount&gt;
          &lt;mountby config:type=&quot;symbol&quot;&gt;label&lt;/mountby&gt;
          &lt;partition_id config:type=&quot;integer&quot;&gt;131&lt;/partition_id&gt;
          &lt;partition_nr config:type=&quot;integer&quot;&gt;1&lt;/partition_nr&gt;
          &lt;raid_options/&gt;
          &lt;resize config:type=&quot;boolean&quot;&gt;false&lt;/resize&gt;
          &lt;size&gt;max&lt;/size&gt;
        &lt;/partition&gt;
        &lt;/partitions&gt;
        &lt;/drive&gt;
        &lt;/partitioning&gt; 
  &lt;report&gt;
    &lt;errors&gt;
      &lt;log config:type=&quot;boolean&quot;&gt;true&lt;/log&gt;
      &lt;show config:type=&quot;boolean&quot;&gt;true&lt;/show&gt;
      &lt;timeout config:type=&quot;integer&quot;&gt;10&lt;/timeout&gt;
    &lt;/errors&gt;
    &lt;messages&gt;
      &lt;log config:type=&quot;boolean&quot;&gt;true&lt;/log&gt;
      &lt;show config:type=&quot;boolean&quot;&gt;true&lt;/show&gt;
      &lt;timeout config:type=&quot;integer&quot;&gt;10&lt;/timeout&gt;
    &lt;/messages&gt;
    &lt;warnings&gt;
      &lt;log config:type=&quot;boolean&quot;&gt;true&lt;/log&gt;
      &lt;show config:type=&quot;boolean&quot;&gt;true&lt;/show&gt;
      &lt;timeout config:type=&quot;integer&quot;&gt;10&lt;/timeout&gt;
    &lt;/warnings&gt;
    &lt;yesno_messages&gt;
      &lt;log config:type=&quot;boolean&quot;&gt;false&lt;/log&gt;
      &lt;show config:type=&quot;boolean&quot;&gt;false&lt;/show&gt;
      &lt;timeout config:type=&quot;integer&quot;&gt;0&lt;/timeout&gt;
    &lt;/yesno_messages&gt;
  &lt;/report&gt;
  &lt;runlevel&gt;
    &lt;services config:type=&quot;list&quot;&gt;
      &lt;service&gt;
        &lt;service_name&gt;sshd&lt;/service_name&gt;
        &lt;service_status&gt;enable&lt;/service_status&gt;
        &lt;service_start&gt;3 5&lt;/service_start&gt;
      &lt;/service&gt;
    &lt;/services&gt;
  &lt;/runlevel&gt;
  &lt;scripts&gt;
    &lt;post-scripts config:type=&quot;list&quot;&gt;
      &lt;script&gt;
        &lt;debug config:type=&quot;boolean&quot;&gt;false&lt;/debug&gt;
        &lt;feedback config:type=&quot;boolean&quot;&gt;false&lt;/feedback&gt;
        &lt;filename&gt;postinstall.sh&lt;/filename&gt;
        &lt;interpreter&gt;shell&lt;/interpreter&gt;
        &lt;!-- &lt;network_needed config:type=&quot;boolean&quot;&gt;false&lt;/network_needed&gt; --&gt;
        &lt;source&gt;&lt;![CDATA[#!/bin/bash
wget http://yum.stratuslab.eu/snapshots/fedora14/stratuslab-one-context-0.0.1-0.20111215.110102.noarch.rpm
rpm -ivh stratuslab-one-context-0.0.1-0.20111215.110102.noarch.rpm
sed -i &#039;s/context_device.*$/context_device=sr0/&#039; /etc/stratuslab/stratuslab-one-context.cfg
# Remove any occurences of the mac address
rm -f /etc/udev/rules.d/70-persistent-*.rules
echo &quot;[Unit]
Description=/etc/init.d/after.local Compatibility
ConditionFileIsExecutable=/etc/init.d/after.local

[Service]
Type=oneshot
ExecStart=/etc/init.d/after.local
TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes
SysVStartPriority=99

[Install]
WantedBy=multi-user.target&quot; &gt; /lib/systemd/system/after-local.service
sudo systemctl enable /lib/systemd/system/after-local.service
echo &quot;/usr/bin/stratuslab-one-context&quot; &gt;&gt; /etc/init.d/after.local
echo &quot;modprobe acpiphp&quot; &gt;&gt; /etc/init.d/after.local
]]&gt;&lt;/source&gt;
      &lt;/script&gt;
    &lt;/post-scripts&gt;
  &lt;/scripts&gt;
  &lt;software&gt;
    &lt;packages config:type=&quot;list&quot;&gt;
      &lt;package&gt;openssh&lt;/package&gt;
    &lt;/packages&gt;
    &lt;patterns config:type=&quot;list&quot;&gt;
      &lt;pattern&gt;apparmor&lt;/pattern&gt;
      &lt;pattern&gt;base&lt;/pattern&gt;
      &lt;pattern&gt;enhanced_base&lt;/pattern&gt;
      &lt;pattern&gt;sw_management&lt;/pattern&gt;
      &lt;pattern&gt;yast2_basis&lt;/pattern&gt;
      &lt;pattern&gt;yast2_install_wf&lt;/pattern&gt;
    &lt;/patterns&gt;
  &lt;/software&gt;
  &lt;timezone&gt;
    &lt;hwclock&gt;UTC&lt;/hwclock&gt;
    &lt;timezone&gt;Etc/UTC&lt;/timezone&gt;
  &lt;/timezone&gt;
  &lt;users config:type=&quot;list&quot;&gt;
    &lt;user&gt;
      &lt;encrypted config:type=&quot;boolean&quot;&gt;true&lt;/encrypted&gt;
      &lt;user_password&gt;$1$lFa4QIio$Wb8v1xsKePKngDT6CDqeF0&lt;/user_password&gt;
      &lt;username&gt;root&lt;/username&gt;
    &lt;/user&gt;
  &lt;/users&gt;
&lt;/profile&gt;</pre>

<p>
Saved in opensuse12.1_profile.xml, it could be used with virt-manager:
</p>
<pre class="code">virt-install --accelerate --hvm --name suse12.1 --ram=1000 --disk /tmp/disk.img --location=http://download.opensuse.org/distribution/12.1/repo/oss/ -x &quot;install=http://download.opensuse.org/distribution/12.1/repo/oss/ autoyast=http://example.org//opensuse12.1_profile.xml&quot; --network bridge=br0 --mac macaddress  --noreboot</pre>

		</div>
  
    
        <div class="stylefoot">
      <div class="meta">
        <div class="doc">
	  <!--
          tutorial/baseimagecreationaytoyast.txt &middot; Last modified: 2012/03/20 14:05 by airaj	  -->
        </div>
        <div class="user">
                  </div>
      </div>
          </div>
    
<div class="container_12" id="footer">

<div class="clear">&nbsp;</div>
<div class="footspacer">&nbsp;</div>


<div class="grid_2 push_10 omega">
<a class="footerlink" href="mailto:info@stratuslab.eu">General queries</a><br>
<a class="footerlink" href="mailto:support@stratuslab.eu">Support queries</a>
<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>
<a class="footerlink" href="internal.html">Go to project internal pages</a> 
</div>

<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>




<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>


<div class="grid_1 push_2 alpha">
<div class="partnerlink">
<a class="imagelink" href="./project:cnrs.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/cnrs-logo.png"></a></a>
<a class="partnerlink" href="./project:cnrs.html">CNRS</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:grnet.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/grnet-logo.png"></a><br>
<a class="partnerlink" href="./project:grnet.html">GRNET</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:sixsq.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/sixsq-logo.png"></a><br>
<a class="partnerlink" href="./project:sixsq.html">SixSq Sàrl</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:ucm.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/ucm-logo.png"></a><br>
<a class="partnerlink" href="./project:ucm.html">UCM</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:tid.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/tid-logo.png"></a><br>
<a class="partnerlink" href="./project:tid.html">TID</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:tcd.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/tcd-logo.png"></a><br>
<a class="partnerlink" href="./project:tcd.html">TCD</a>
</div>
</div>
<div class="grid_1 push_4 omega">
<img src="../lib/tpl/stratuslab-theme/images/FP7-cap-CMYK.png">
</div>
<div class="grid_1 push_4">
<img src="../lib/tpl/stratuslab-theme/images/eu-flag-blue-yellow.png">
</div>
<!-- <div class="grid_2 push_3 omega">
<img src="images/e-infrastructure-logo.png">
</div> -->

<div class="spacer">&nbsp;</div>
<div class="grid_10 push_2">
The StratusLab project is co-funded by the European Community's Seventh Framework Programme (Capacities) Grant Agreement INFSO-RI-261552.
</div>
<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>


</div> <!-- end container_12 div -->

	    </div>
</body>
</html>
