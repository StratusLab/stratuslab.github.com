<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
<head>
  <title>  StratusLab :: Tutorial: VM Lifecycle  </title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="Author" content="Marcin Mierzejewski @ Zenzire"/>
  <meta name="Keywords" content="StratusLab,Tutorial: VM Lifecycle"/>
  <meta name="Description" content="StratusLabTutorial: VM Lifecycle"/>
  <meta name="generator" content="DokuWiki" />
<meta name="robots" content="index,follow" />
<meta name="date" content="2012-03-20T13:44:54+0100" />
<meta name="keywords" content="tutorial,machinelifecycle" />
<link rel="search" type="application/opensearchdescription+xml" href="../lib/exe/opensearch.php" title="StratusLab" />
<link rel="start" href="../index.html" />
<link rel="contents" href="./tutorial:machinelifecycle.html?do=index" title="Sitemap" />
<link rel="canonical" href="./tutorial:machinelifecycle.html" />
<link rel="stylesheet" media="screen" type="text/css" href="../lib/exe/css.php?t=stratuslab-theme&amp;tseed=1349958590" />
<link rel="stylesheet" media="all" type="text/css" href="../lib/exe/css.php?s=all&amp;t=stratuslab-theme&amp;tseed=1349958590" />
<link rel="stylesheet" media="print" type="text/css" href="../lib/exe/css.php?s=print&amp;t=stratuslab-theme&amp;tseed=1349958590" />
<script type="text/javascript" ><!--//--><![CDATA[//><!--
var NS='tutorial';var JSINFO = {"id":"tutorial:machinelifecycle","namespace":"tutorial"};
//--><!]]></script>
<script type="text/javascript" charset="utf-8" src="../lib/exe/js.php?tseed=1349958590" ></script>

  <link rel="stylesheet" media="screen" type="text/css" href="../lib/tpl/stratuslab-theme/css/design.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="../lib/tpl/stratuslab-theme/css/gallery.css" />
  <link rel="stylesheet" type="text/css" href="../lib/tpl/stratuslab-theme/css/960.css" media="screen" />

  <script type="text/javascript">

   var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-18570821-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
 })();

</script>
</head>

<body>
  <div class="Page">
		<div class="Header">

			<div class="Banner">
			      </div>

			<div class="MenuContainer"><div class="Menu" id="level1">
<p>

<!-- main menu under the banner -->
<div class="mainmenu">
<span class="menuitem">
<a class="menulink" href="../index.html">Home</a>
</span>
<span class="menuitem">
<a class="menulink" href="./release:install.html">Install</a>
</span>
<span class="menuitem">
<a class="menulink" href="support.html">Support</a>
</span>
<span class="menuitem">
<a class="menulink" href="documentation.html">Documentation</a>
</span>
<span class="menuitem">
<a class="menulink" href="./roadmap:project_roadmap.html">Roadmap</a>
</span>
<span class="menuitem">
<a class="menulink" href="news.html">News</a>
</span>
<span class="menuitem">
<a class="menulink" href="./project:info.html">About</a>
</span>
</div>


</p>
</div><div class="Menu" id="level2"></div>
		</div> 


    	
		<div class="Content">
				<!-- TOC START -->
<div class="toc">
<div class="tocheader toctoggle" id="toc__header">Table of Contents</div>
<div id="toc__inside">

<ul class="toc">
<li class="level1"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#tutorialvm_lifecycle" class="toc">Tutorial: VM Lifecycle</a></span></div>
<ul class="toc">
<li class="level2"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#configure_user_parameters" class="toc">Configure User Parameters</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#installation.html_from_an_rpm" class="toc">Installation from an RPM</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#installation.html_from_tarball" class="toc">Installation from tarball</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#don_t_want_to_use_stratuslab-usercfg" class="toc">Don&#039;t want to use stratuslab-user.cfg</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#create_a_virtual_machine_instance" class="toc">Create a Virtual Machine Instance</a></span></div></li>
<li class="level2"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#interact_with_machine_instance" class="toc">Interact with Machine Instance</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#determining_the_status" class="toc">Determining the Status</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#logging_into_the_instance" class="toc">Logging into the Instance</a></span></div></li>
</ul>
</li>
<li class="level2"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#terminating_an_instance" class="toc">Terminating an Instance</a></span></div>
<ul class="toc">
<li class="level3"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#graceful_shutdown" class="toc">Graceful Shutdown</a></span></div></li>
<li class="level3"><div class="li"><span class="li"><a href="./tutorial:machinelifecycle.html#killing_an_instance" class="toc">Killing an Instance</a></span></div></li></ul>
</li></ul>
</li></ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1"><a name="tutorialvm_lifecycle" id="tutorialvm_lifecycle">Tutorial: VM Lifecycle</a></h1>
<div class="level1">

<p>

The normal lifecycle of a virtual machine involves starting a machine instance, interacting with that instance (either by logging in or using services provided by the instance), and then shutting the machine down.  The section of the tutorial walks you through this lifecycle and demonstrates the associated commands.
</p>

<p>
<em>Note: You must have a username/password for the StratusLab cloud installation that you are using.</em> Contact the <a href="./release:v0.1.html#support" class="wikilink1" title="release:v0.1">support.html mailing list</a> if you want access to the StratusLab <a href="referenceservices.html" class="wikilink1" title="referenceservices">reference cloud infrastructure</a>. 
</p>

</div>

<h2 class="sectionedit2"><a name="configure_user_parameters" id="configure_user_parameters">Configure User Parameters</a></h2>
<div class="level2">

<p>
User parameters configuration depends on how you installed the StratusLab client tools:
</p>
<ul>
<li class="level1"><div class="li"> from an RPM package or,</div>
</li>
<li class="level1"><div class="li"> from a standalone tarball. </div>
</li>
</ul>

</div>

<h2 class="sectionedit3"><a name="installation_from_an_rpm" id="installation_from_an_rpm">Installation from an RPM</a></h2>
<div class="level2">
<pre class="code">mkdir $HOME/.stratuslab
cp /etc/stratuslab/stratuslab-user.cfg.ref $HOME/.stratuslab/stratuslab-user.cfg </pre>

</div>

<h2 class="sectionedit4"><a name="installation_from_tarball" id="installation_from_tarball">Installation from tarball</a></h2>
<div class="level2">
<pre class="code">mkdir $HOME/.stratuslab
cp $HOME/stratuslab/conf/stratuslab-user.cfg.ref  $HOME/.stratuslab/stratuslab-user.cfg </pre>

<p>
In stratuslab-user.cfg, in case you chose rpm or tarball installation, provide the Cloud frontend, your username/password, and your ssh public key.

</p>
<pre class="code">endpoint = &lt;Cloud endpoint URL&gt;
username = &lt;StratusLab username&gt;
password = &lt;StratusLab password&gt;
user_public_key_file = &lt;ssh public key filename&gt;</pre>

<p>

Other information could be provided (aren&#039;t mandatory to create VM instance), like:
</p>
<ul>
<li class="level1"><div class="li"> PEM key/cert if you want to use authentication with grid certificate, if username/password and PEM key/cert are both enabled, PEM key/cert takes precedence.</div>
</li>
<li class="level3"><div class="li"> marketplace_endpoint: Marketplace endpoint to be used when uploading metadata, and/or  when creating instance of VM</div>
</li>
<li class="level3"><div class="li"> p12_certificate: PKSC12-formatted certificate, for signing and validating image metadata</div>
</li>
<li class="level3"><div class="li"> apprepo_endpoint, apprepo_username, apprepo_password: Appliance repository endpoint, username and password to be able to upload images and appliances to the Appliance repository.      </div>
</li>
</ul>

</div>

<h2 class="sectionedit5"><a name="don_t_want_to_use_stratuslab-usercfg" id="don_t_want_to_use_stratuslab-usercfg">Don&#039;t want to use stratuslab-user.cfg</a></h2>
<div class="level2">

<p>
Setup the environment with this information:

</p>
<pre class="code">export STRATUSLAB_KEY=&lt;ssh public key filename&gt;
export STRATUSLAB_USERNAME=&lt;StratusLab username&gt;
export STRATUSLAB_PASSWORD=&lt;StratusLab password&gt;
export STRATUSLAB_ENDPOINT=&lt;Cloud endpoint URL&gt;</pre>

</div>

<h2 class="sectionedit6"><a name="create_a_virtual_machine_instance" id="create_a_virtual_machine_instance">Create a Virtual Machine Instance</a></h2>
<div class="level2">

<p>
To demonstrate how to launch a simple machine, we will use the <a href="http://appliances.stratuslab.eu/images/base/ttylinux-10.0-i486-base/1.0/ttylinux-10.0-i486-base-1.0.img.gz" class="urlextern" title="http://appliances.stratuslab.eu/images/base/ttylinux-10.0-i486-base/1.0/ttylinux-10.0-i486-base-1.0.img.gz"  rel="nofollow">ttylinux-10.0 image</a> from the appliance repository, identified in the <a href="http://marketplace.stratuslab.eu/" class="urlextern" title="http://marketplace.stratuslab.eu/"  rel="nofollow">Marketplace</a> by  BzrqtDb2pYxA5_jha4IXG4WLyD3 .
</p>

<p>
The command <code>stratus-run-instance</code> allows you to create a new instance of an image stored in the appliances repository and identified by an ID in the Marketplace.  Here is how you can create a new instance of the <code>ttylinux</code> base image:
</p>
<pre class="code">export TTYLINUX_MarketplaceID=GOaxJFdoEXvqAm9ArJgnZ0_ky6F</pre>

<p>
The <code>–key</code> allows you to specify a public key to be inserted in the new instance, such that you can SSH to it using your private key. The <code>&lt;public-key-filename&gt;</code> value should correspond to the <code>id_rsa.pub</code> file created earlier during this tutorial.
</p>

<p>

Creating new instance of ttylinux by passing it&#039;s ID in the Marketplace: 

</p>
<pre class="code">stratus-run-instance $TTYLINUX_MarketplaceID </pre>

<p>
By default StratusLab Marketplace endpoint is: <a href="http://marketplace.stratuslab.eu" class="urlextern" title="http://marketplace.stratuslab.eu"  rel="nofollow">http://marketplace.stratuslab.eu</a>.
</p>

<p>
If you are using another Marketplace, please provide it in your $HOME/.stratuslab/stratuslab-user.cfg, 
</p>

<p>
or set the environment variable STRATUSLAB_MARKETPLACE_ENDPOINT with the Markeplace endpoint you want to use, 
</p>

<p>
or pass it as argument to stratus-run-instance command when starting instance.
</p>

<p>
If provided in your $HOME/.stratuslab/stratuslab-user.cfg 

</p>
<pre class="code">stratus-run-instance $TTYLINUX_MarketplaceID </pre>

<p>

If set up as environment variable, like:

</p>
<pre class="code">export STRATUSLAB_MARKETPLACE_ENDPOINT=http://yourMarketplace</pre>

<p>

Then

</p>
<pre class="code">stratus-run-instance  $TTYLINUX_MarketplaceID </pre>

<p>

Else

</p>
<pre class="code">stratus-run-instance --marketplace-endpoint=http://yourMarketplace $TTYLINUX_MarketplaceID </pre>

<p>
Like all StratusLab commands, <code>-h</code> or <code>–help</code> will give you the list of options the command supports.
</p>

<p>
Issuing the above command will produce an output similar to this:
</p>
<pre class="file"> ::::::::::::::::::::::::
 :: Starting 1 machine ::
 ::::::::::::::::::::::::

 :: Machine 1 (vm ID: 17)
        public IP: 134.158.73.236
 :::::::::::
 :: Done! ::
 :::::::::::</pre>

<p>
Once the new instance has been created, you should be able to log into it as soon as it is fully booted. 
</p>

<p>

You can  choose between <code>public</code> (default), <code>local</code> and <code>private</code> IP assignment for your new instances. Using <code>stratus-run-instance</code> add <code>–local–ip</code> or <code>–private-ip</code> to instruct StratusLab to assign a local IP address (i.e. locally accessible from inside the site but not from outside), or private IP address (i.e. unreachable machine, which implies that the instance will initiate the communication with other machines/instances).
</p>

</div>

<h2 class="sectionedit7"><a name="interact_with_machine_instance" id="interact_with_machine_instance">Interact with Machine Instance</a></h2>
<div class="level2">

</div>

<h3 class="sectionedit8"><a name="determining_the_status" id="determining_the_status">Determining the Status</a></h3>
<div class="level3">

<p>

To determine the status of one or several instances, you can use the <code>stratus-describe-instance</code> command.  With the environment variables defined as above you can simply issue the following command to query the status of all of your active instances:

</p>
<pre class="code">$ stratus-describe-instance
id  state           cpu       memory    public ip
16  Running         1         128       134.158.73.235  
17  Running         1         128       134.158.73.236  </pre>

<p>

You can also specify a particular <code>vm-id</code> to see the information for a single machine instance.  This will also provide information for inactive machines that no longer appear in the list.

</p>
<pre class="code">$ stratus-describe-instance 17
id  state           cpu       memory    public ip
17  Running         1         128       134.158.73.236  </pre>

</div>

<h3 class="sectionedit9"><a name="logging_into_the_instance" id="logging_into_the_instance">Logging into the Instance</a></h3>
<div class="level3">

<p>

Once the instance is running, you should be able to ping the machine instance or log into using SSH.  Here&#039;s an example:

</p>
<pre class="code">$ ping &lt;ip-address&gt;
$ ssh -i &lt;private-key-file&gt; root@&lt;ip-address&gt;</pre>

<p>

The <code>&lt;ip-address&gt;</code> corresponding to your instance is provided by the <code>stratus-run-instance</code>, the Web Monitor application or <code>stratus-describe-instance</code> command.  The private key file must be the one which corresponds to the public key that you gave when starting the machine. 
</p>

<p>
You can also log into your VM using stratus-connect-instance command and VM identifier:

</p>
<pre class="code">$ stratus-connect-instance VM_ID</pre>

<p>
<strong>You log into the machine using the root account.</strong>  All of the default base images have only the root account configured.  As you have root access, you can install new software, change the configuration, etc.  Reboot the instance will preserve those changes; however, those changes will be lost when the instance is killed.
</p>

</div>

<h2 class="sectionedit10"><a name="terminating_an_instance" id="terminating_an_instance">Terminating an Instance</a></h2>
<div class="level2">

</div>

<h3 class="sectionedit11"><a name="graceful_shutdown" id="graceful_shutdown">Graceful Shutdown</a></h3>
<div class="level3">

<p>

You can shutdown the instance gracefully from within the machine, issue either the <code>halt</code> or <code>shutdown</code> commands.  You should use a command that <strong>powers down</strong> the machine for the OS that you have running.  For ttylinux, the command is:

</p>
<pre class="code">$ shutdown -h </pre>

<p>

This will execute the normal shutdown sequence and then free the resources associated with the instance.  If you halt the machine rather than power it down, you can kill the instance with the StratusLab client.
</p>

<p>
Using stratus-shutdown-instance, shutdown could also be performed on machines supporting ACPI, just launch:

</p>
<pre class="code">$ stratus-shutdown-instance VM_ID </pre>

<p>
NB. ttylinux doesn&#039;t support ACPI.
</p>

</div>

<h3 class="sectionedit12"><a name="killing_an_instance" id="killing_an_instance">Killing an Instance</a></h3>
<div class="level3">

<p>

To terminate an instance from the outside, you can use the StratusLab client:

</p>
<pre class="code">$ stratus-kill-instance &lt;vm-id&gt; ...</pre>

<p>

This command allows you to specifiy one or more <code>&lt;vm-id&gt;</code>.
</p>

<p>
Note that this is the equivalent of yanking the powercord from the socket.  Use a graceful shutdown if there is any chance of leaving resources in a bad state (e.g. having external data mounted in the instance).  

</p>

</div>

		</div>
  
    
        <div class="stylefoot">
      <div class="meta">
        <div class="doc">
	  <!--
          tutorial/machinelifecycle.txt &middot; Last modified: 2012/03/20 13:44 by airaj	  -->
        </div>
        <div class="user">
                  </div>
      </div>
          </div>
    
<div class="container_12" id="footer">

<div class="clear">&nbsp;</div>
<div class="footspacer">&nbsp;</div>


<div class="grid_2 push_10 omega">
<a class="footerlink" href="mailto:info@stratuslab.eu">General queries</a><br>
<a class="footerlink" href="mailto:support@stratuslab.eu">Support queries</a>
<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>
<a class="footerlink" href="internal.html">Go to project internal pages</a> 
</div>

<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>




<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>


<div class="grid_1 push_2 alpha">
<div class="partnerlink">
<a class="imagelink" href="./project:cnrs.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/cnrs-logo.png"></a></a>
<a class="partnerlink" href="./project:cnrs.html">CNRS</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:grnet.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/grnet-logo.png"></a><br>
<a class="partnerlink" href="./project:grnet.html">GRNET</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:sixsq.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/sixsq-logo.png"></a><br>
<a class="partnerlink" href="./project:sixsq.html">SixSq Sàrl</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:ucm.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/ucm-logo.png"></a><br>
<a class="partnerlink" href="./project:ucm.html">UCM</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:tid.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/tid-logo.png"></a><br>
<a class="partnerlink" href="./project:tid.html">TID</a>
</div>
</div>
<div class="grid_1 push_2">
<div class="partnerlink">
<a class="imagelink" href="./project:tcd.html"><img src="../lib/tpl/stratuslab-theme/images/partnerlogos/tcd-logo.png"></a><br>
<a class="partnerlink" href="./project:tcd.html">TCD</a>
</div>
</div>
<div class="grid_1 push_4 omega">
<img src="../lib/tpl/stratuslab-theme/images/FP7-cap-CMYK.png">
</div>
<div class="grid_1 push_4">
<img src="../lib/tpl/stratuslab-theme/images/eu-flag-blue-yellow.png">
</div>
<!-- <div class="grid_2 push_3 omega">
<img src="images/e-infrastructure-logo.png">
</div> -->

<div class="spacer">&nbsp;</div>
<div class="grid_10 push_2">
The StratusLab project is co-funded by the European Community's Seventh Framework Programme (Capacities) Grant Agreement INFSO-RI-261552.
</div>
<div class="clear">&nbsp;</div>
<div class="spacer">&nbsp;</div>


</div> <!-- end container_12 div -->

	    </div>
</body>
</html>
